# ComfyUI 工作流批量测试平台使用指南

## 环境准备
1. 建议使用 Python 3.10 及以上版本，并创建独立虚拟环境。
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

## 启动服务
使用 Uvicorn 启动 FastAPI 服务：
```bash
uvicorn webapp.app:app --host 0.0.0.0 --port 8000 --reload
```
启动后访问 `http://127.0.0.1:8000` 即可使用网页端测试平台。

## 页面结构
- **工作流管理**：左侧树状结构展示 `workflow/` 目录，可批量上传（自动创建时间戳子文件夹）、重命名、删除节点，并支持一键勾选或删除整个文件夹。
- **工作流分组**：自动扫描 `workflow/` 目录，将具有相同输入占位符和输出类型的工作流归为一组，只有同组工作流才能被同时勾选。
- **占位符配置**：展示当前分组的输入占位符（例如 `input_image_l`、`input_image_r`），点击“选择媒体”后，可在弹窗中上传或选择素材并完成绑定。
- **工作流列表**：勾选需要运行的工作流，默认全选当前分组的全部工作流。
- **任务队列**：展示最近提交的任务状态、起止时间以及失败原因。
- **媒体资源管理**：针对 `media/` 目录提供浏览、上传、创建文件夹、重命名等操作，同时支持图片/视频预览。

## 批量测试流程
1. 在顶部输入 ComfyUI 服务器地址（默认为 `http://127.0.0.1:8188`），设置可选的输出目录。
2. 可在左侧“工作流管理”上传或整理工作流，勾选文件夹或单个工作流后，系统会自动匹配对应分组；也可以直接在下方分组列表手动选择。
3. 勾选希望执行的工作流后点击“开始批量测试”，系统会在后台调用 `batch_workflow_tester` 上传资源并触发执行。
4. 在任务队列中可查看运行结果；输出文件保存在配置的输出目录（默认 `workflow_test_output/`）中。

## 注意事项
- 媒体选择仅允许来自 `media/` 目录，避免使用相对路径跳出该目录。
- 批量运行前务必确认占位符绑定资源完整，否则服务端会拒绝请求。
- 如需刷新工作流分组（新增或修改 JSON 文件后），点击页面右上角“刷新工作流”按钮即可。
